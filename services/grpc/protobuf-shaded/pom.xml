<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd">
  <modelVersion>4.0.0</modelVersion>
  <parent>
		<artifactId>geowave-service-parent</artifactId>
		<groupId>mil.nga.giat</groupId>
		<relativePath>../../</relativePath>
		<version>0.9.8-SNAPSHOT</version>
  </parent>
  <artifactId>geowave-grpc-protobuf-shaded</artifactId>
	<name>GeoWave gRPC Protobuf Library with Proto3</name>
  <dependencies>	
		<dependency>
		  <groupId>io.grpc</groupId>
		  <artifactId>grpc-protobuf</artifactId>
		  <version>1.2.0</version>
		</dependency>
		<dependency>
				<groupId>com.google.guava</groupId>
				<artifactId>guava</artifactId>
				<version>23.2-jre</version>
			</dependency>
		<dependency>
		  <groupId>io.grpc</groupId>
		  <artifactId>grpc-netty</artifactId>
		  <version>1.2.0</version>
		</dependency>
		<dependency>
		  <groupId>io.grpc</groupId>
		  <artifactId>grpc-stub</artifactId>
		  <version>1.2.0</version>
		</dependency>
	</dependencies>
  <build>
    <plugins>
      <plugin>
        <groupId>org.codehaus.mojo</groupId>
        <artifactId>exec-maven-plugin</artifactId>
        <version>1.6.0</version>
        <executions>
          <execution>
            <phase>generate-sources</phase>
            <goals>
              <goal>java</goal>
            </goals>
          </execution>
        </executions>
        <configuration>
          <includeProjectDependencies>false</includeProjectDependencies>
          <includePluginDependencies>true</includePluginDependencies>
          <mainClass>mil.nga.giat.geowave.service.grpc.GeowaveOperationGrpcGenerator</mainClass>
          <arguments>
            <argument>${project.basedir}</argument>
          </arguments>
        </configuration>
        <dependencies>
          <dependency>
            <groupId>mil.nga.giat</groupId>
            <artifactId>geowave-grpc-protobuf-generator</artifactId>
            <version>${project.version}</version>
            <type>jar</type>
          </dependency>
        </dependencies>
      </plugin>	
     
      <plugin>
		<groupId>com.github.os72</groupId>
		<artifactId>protoc-jar-maven-plugin</artifactId>
		<version>3.4.0.1</version>
		<executions>
			<execution>
				<phase>generate-sources</phase>
				<goals>
					<goal>run</goal>
				</goals>
				<configuration>
					<protocArtifact>com.google.protobuf:protoc:3.0.0</protocArtifact>
					<inputDirectories>
						<include>src/main/protobuf</include>
					</inputDirectories>
					<outputTargets>
						<outputTarget>
							<type>java</type>
							<outputDirectory>src/main/java</outputDirectory>
						</outputTarget>
						<outputTarget>
							<type>grpc-java</type>
							<outputDirectory>src/main/java</outputDirectory>
							<pluginArtifact>io.grpc:protoc-gen-grpc-java:1.0.1</pluginArtifact>
						</outputTarget>
					</outputTargets>
				</configuration>
			</execution>
		</executions>
	</plugin>
	<plugin>
        <artifactId>maven-shade-plugin</artifactId>
        <version>2.4</version>
        <executions>
          <execution>
            <phase>package</phase>
            <goals>
              <goal>shade</goal>
            </goals>
            <configuration>
              <filters>
                <filter>
                  <artifact>*:*</artifact>
                  <includes>
                    <!--  <include>mil/nga/giat/**</include>
                    <include>com/google/protobuf/**</include>
                    <include>io/grpc/protobuf/**</include>-->
                    <include>mil/nga/giat/**</include>
                    <include>com/google/**</include>
                    <include>io/grpc/**</include>
                    <include>io/netty/**</include>
                  </includes>
                </filter>
              </filters>
              <relocations>
                <relocation>
                  <!--  <pattern>com.google.protobuf</pattern>
                  <shadedPattern>com.google.protoshadebuf3</shadedPattern>-->
                  <pattern>com.google</pattern>
                  <shadedPattern>com.googleshaded</shadedPattern>
                </relocation>
                <relocation>
                   <pattern>io.grpc</pattern>
                  <shadedPattern>io.grpcshaded</shadedPattern>
                </relocation>
                <relocation>
                   <pattern>io.netty</pattern>
                  <shadedPattern>io.nettyshaded</shadedPattern>
                </relocation>
              </relocations>
              <createSourcesJar>true</createSourcesJar>
              <shadeSourcesContent>true</shadeSourcesContent>
            </configuration>
          </execution>
        </executions>
      </plugin>
    </plugins>
  </build>
</project>

